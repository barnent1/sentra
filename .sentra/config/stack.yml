# Sentra Standard Stack Configuration
# This file defines the default technology stack for new projects
# Eventually this will be configurable via the Sentra UI

version: "1.0"
name: "sentra-standard-stack"
description: "Production-ready Next.js stack used by top companies"

# Next.js Project Initialization
nextjs:
  version: "15.5"
  create_command: |
    npx create-next-app@latest . \
      --typescript \
      --tailwind \
      --eslint \
      --app \
      --no-src-dir \
      --import-alias "@/*" \
      --use-npm \
      --no-turbopack

  # Answers to interactive prompts (if needed)
  prompts:
    - question: "Would you like to use React Compiler?"
      answer: "No"
    - question: "Which linter would you like to use?"
      answer: "ESLint"

# Core Dependencies
core:
  next: "15.5.3"
  react: "19.0.0"
  react-dom: "19.0.0"
  typescript: "5.6.3"

# UI & Styling
ui:
  category: "UI Components"
  options:
    - name: "shadcn/ui"
      recommended: true
      bundle_size: "2.3KB"
      description: "Copy-paste components with Radix UI + Tailwind"
      setup_command: "npx shadcn@latest init"
      dependencies:
        - "@radix-ui/react-*"
        - "class-variance-authority"
        - "clsx"
        - "tailwind-merge"
    - name: "Material UI"
      recommended: false
      bundle_size: "91.7KB"
      dependencies:
        - "@mui/material"
        - "@mui/icons-material"
        - "@emotion/react"
        - "@emotion/styled"

styling:
  category: "Styling"
  default: "tailwindcss"
  options:
    - name: "tailwindcss"
      version: "3.4.15"
      recommended: true
      plugins:
        - "tailwindcss-animate"
        - "@tailwindcss/typography"
        - "@tailwindcss/forms"

icons:
  category: "Icons"
  default: "lucide-react"
  options:
    - name: "lucide-react"
      version: "latest"
      recommended: true
      bundle_size: "~1KB per icon"
    - name: "react-icons"
      version: "latest"
      bundle_size: "~50KB"

# Database & ORM
database:
  category: "Database & Backend"
  default: "supabase"

  # Supabase: All-in-one platform (DATABASE + AUTH + STORAGE + REALTIME)
  supabase:
    version: "latest"
    recommended: true
    cost: "$25-35/mo for 10-20GB (vs $400/mo MongoDB)"
    use_case: "Production SaaS applications"
    benefits:
      - "PostgreSQL database with auto-scaling"
      - "Built-in authentication (email, OAuth, magic links)"
      - "Built-in file storage (S3-compatible)"
      - "Built-in realtime (WebSocket pub/sub)"
      - "Built-in audit logging via supa_audit (FREE PITR alternative)"
      - "Row-level security built into database"
      - "Auto-generated REST and GraphQL APIs"
      - "SOC 2, HIPAA, GDPR compliant"
    regions:
      us:
        - "US East (Virginia)"
        - "US West (California)"
      eu:
        - "EU West (Ireland)"
        - "EU Central (Frankfurt)"
        - "EU West (London)"
    setup_command: "npx supabase init && npx supabase start"
    dependencies:
      - "@supabase/supabase-js"
      - "@supabase/ssr"  # For Next.js App Router
    dev_dependencies:
      - "supabase"  # Supabase CLI

    # Audit Logging (supa_audit extension)
    audit_logging:
      extension: "supa_audit"
      description: "Track all data changes with row-level granularity"
      cost: "$0/month + storage at $0.125/GB (vs $100/mo PITR add-on)"
      retention_recommended: "90 days"
      setup: |
        -- Enable supa_audit extension
        CREATE EXTENSION IF NOT EXISTS "supa_audit";

        -- Enable tracking for critical tables
        SELECT audit.enable_tracking('public.users'::regclass);
        SELECT audit.enable_tracking('public.projects'::regclass);
        SELECT audit.enable_tracking('public.activities'::regclass);

        -- Optional: Configure retention (default: keep forever)
        -- DELETE FROM audit.record_version
        -- WHERE ts < NOW() - INTERVAL '90 days';
      query_example: |
        -- Query audit history
        SELECT
          record_id,
          op,  -- INSERT, UPDATE, DELETE
          ts,  -- timestamp
          table_name,
          record,  -- full new record
          old_record  -- full old record (for updates/deletes)
        FROM audit.record_version
        WHERE table_name = 'projects'
          AND ts > NOW() - INTERVAL '7 days'
        ORDER BY ts DESC;
      benefits:
        - "Point-in-time recovery without PITR add-on (saves $1,200/year)"
        - "Track all data changes with row-level granularity"
        - "Compliance audit trails (SOC 2, HIPAA requirements)"
        - "Debug production issues easily"
        - "Rollback data changes when needed"

  # ORM Choice (use with Supabase)
  orm:
    default: "drizzle"
    options:
      - name: "drizzle-orm"
        version: "latest"
        recommended: true
        use_case: "Type-safe SQL with Supabase"
        benefits:
          - "7KB bundle (tiny)"
          - "SQL-like syntax"
          - "Perfect TypeScript integration"
          - "Works great with Supabase"
        setup_command: "npm install drizzle-orm drizzle-kit"
        dependencies:
          - "drizzle-orm"
          - "postgres"  # PostgreSQL driver
        dev_dependencies:
          - "drizzle-kit"

      - name: "prisma"
        version: "6.0.0"
        recommended: false
        use_case: "If you prefer Prisma DX"
        benefits:
          - "Great developer experience"
          - "Visual database browser"
          - "Mature ecosystem"
        setup_command: "npx prisma init"
        dependencies:
          - "@prisma/client"
        dev_dependencies:
          - "prisma"

# State Management
state:
  category: "State Management"
  default: "zustand"
  options:
    - name: "zustand"
      version: "4.5.0"
      recommended: true
      bundle_size: "3KB"
      use_case: "90% of use cases"
    - name: "jotai"
      version: "latest"
      recommended: false
      bundle_size: "4KB"
      use_case: "Complex atomic state"

# Real-time & Reactive Updates
realtime:
  category: "Real-time Updates"
  default: "supabase_realtime"

  options:
    - name: "supabase_realtime"
      version: "included"
      recommended: true
      simplicity: "9/10"
      use_case: "Built-in with Supabase"
      benefits:
        - "Zero configuration required"
        - "WebSocket connections managed automatically"
        - "Subscribe to database changes in real-time"
        - "Works with Row Level Security"
        - "Handles reconnection automatically"
      cost: "$0 (included with Supabase Pro)"
      example: |
        supabase.channel('changes')
          .on('postgres_changes',
            { event: '*', schema: 'public', table: 'activities' },
            (payload) => handleUpdate(payload)
          )
          .subscribe()

    - name: "sse"
      version: "native"
      recommended: false
      simplicity: "8/10"
      use_case: "Simple serverâ†’client notifications"
      benefits:
        - "Built into browsers"
        - "Works over HTTP/2"
        - "Dead simple implementation"
      limitations:
        - "One-way only (server to client)"
        - "6 connection limit per domain"
      cost: "$0"

    - name: "upstash_redis_pubsub"
      version: "latest"
      recommended: false
      simplicity: "6/10"
      use_case: "Multi-server pub/sub without Supabase"
      cost: "$5-20/mo"
      dependencies:
        - "@upstash/redis"

# Data Fetching
data_fetching:
  category: "Data Fetching & Caching"
  default: "@tanstack/react-query"

  options:
    - name: "@tanstack/react-query"
      version: "5.60.0"
      recommended: true
      bundle_size: "15KB"
      use_case: "Server state management with caching"
      benefits:
        - "Automatic caching and revalidation"
        - "Optimistic updates built-in"
        - "Perfect for Supabase + realtime"
        - "Excellent DevTools"
      dependencies:
        - "@tanstack/react-query"
        - "@tanstack/react-query-devtools"
      pattern: |
        // Combine with Supabase Realtime
        const { data } = useQuery({
          queryKey: ['projects'],
          queryFn: fetchProjects
        })

        // Real-time updates invalidate cache
        useEffect(() => {
          const channel = supabase.channel('projects')
            .on('postgres_changes', { event: '*' }, () => {
              queryClient.invalidateQueries(['projects'])
            })
            .subscribe()
        }, [])

    - name: "swr"
      version: "latest"
      recommended: false
      bundle_size: "7KB"
      use_case: "Simpler alternative to React Query"
      dependencies:
        - "swr"

# Forms & Validation
forms:
  category: "Forms"
  default: "react-hook-form"
  options:
    - name: "react-hook-form"
      version: "7.53.0"
      recommended: true
      bundle_size: "12KB"
      dependencies:
        - "react-hook-form"
        - "@hookform/resolvers"

validation:
  category: "Schema Validation"
  default: "zod"
  options:
    - name: "zod"
      version: "3.23.0"
      recommended: true
      bundle_size: "8KB"
      dependencies:
        - "zod"

# Animation
animation:
  category: "Animation"
  default: "framer-motion"
  optional: true
  options:
    - name: "framer-motion"
      version: "11.11.17"
      recommended: true
      bundle_size: "~50KB"
      use_case: "Complex animations, gestures"
      dependencies:
        - "framer-motion"
    - name: "@formkit/auto-animate"
      version: "latest"
      recommended: false
      bundle_size: "2KB"
      use_case: "Simple transitions"
      dependencies:
        - "@formkit/auto-animate"

# Authentication
auth:
  category: "Authentication"
  default: "supabase"
  required: true

  options:
    - name: "supabase"
      version: "latest"
      recommended: true
      use_case: "Built-in with Supabase (recommended)"
      free: "50K MAU"
      benefits:
        - "Included with Supabase (no extra cost)"
        - "Email, OAuth, magic links, phone auth"
        - "Row-level security integration"
        - "Session management built-in"
        - "Passwordless authentication"
      dependencies:
        - "@supabase/supabase-js"
        - "@supabase/ssr"

    - name: "next-auth"
      version: "5.0.0-beta.25"
      recommended: false
      use_case: "If not using Supabase"
      free: true
      dependencies:
        - "next-auth@beta"
        - "bcryptjs"
      dev_dependencies:
        - "@types/bcryptjs"

    - name: "@clerk/nextjs"
      version: "latest"
      recommended: false
      use_case: "Managed service with beautiful UI"
      free: "10K MAU"
      dependencies:
        - "@clerk/nextjs"

# Testing
testing:
  category: "Testing"
  required: true
  unit:
    - name: "vitest"
      version: "latest"
      recommended: true
      dependencies:
        - "vitest"
        - "@vitejs/plugin-react"
      dev_dependencies:
        - "vitest"
        - "@testing-library/react"
        - "@testing-library/jest-dom"
  e2e:
    - name: "playwright"
      version: "latest"
      recommended: true
      dependencies:
        - "@playwright/test"

# Code Quality
quality:
  linting:
    - "eslint"
    - "eslint-config-next"
  formatting:
    - "prettier"
    - "prettier-plugin-tailwindcss"

# Recommended Package.json Scripts
scripts:
  dev: "next dev"
  build: "next build"
  start: "next start"
  lint: "next lint"
  format: "prettier --write ."
  type-check: "tsc --noEmit"
  test: "vitest"
  test:run: "vitest run"
  test:coverage: "vitest run --coverage"
  test:e2e: "playwright test"
  db:generate: "prisma generate"
  db:migrate: "prisma migrate dev"
  db:studio: "prisma studio"

# Installation Order (matters for peer dependencies)
install_order:
  1_core:
    - "next@15.5.3"
    - "react@19.0.0"
    - "react-dom@19.0.0"
    - "typescript@5.6.3"

  2_styling:
    - "tailwindcss"
    - "tailwindcss-animate"
    - "autoprefixer"
    - "postcss"

  3_ui:
    # shadcn/ui installs its own dependencies via CLI
    - "lucide-react"
    - "class-variance-authority"
    - "clsx"
    - "tailwind-merge"

  4_supabase:
    # Supabase client and auth helpers
    - "@supabase/supabase-js"
    - "@supabase/ssr"
    # Supabase CLI (dev dependency)
    - "supabase"  # dev

  5_database_orm:
    # Drizzle ORM (works with Supabase PostgreSQL)
    - "drizzle-orm"
    - "postgres"  # PostgreSQL driver
    - "drizzle-kit"  # dev dependency

  6_forms_validation:
    - "react-hook-form"
    - "@hookform/resolvers"
    - "zod"

  7_state_data:
    - "zustand"
    - "@tanstack/react-query"

  8_testing:
    - "vitest"
    - "@vitejs/plugin-react"
    - "@testing-library/react"
    - "@testing-library/jest-dom"
    - "@playwright/test"

  9_animation_optional:
    - "framer-motion"

  10_caching_optional:
    # Only if you need Redis for caching/rate limiting
    - "@upstash/redis"

# Environment Variables Template
env_template: |
  # Supabase (get these from https://supabase.com/dashboard/project/_/settings/api)
  NEXT_PUBLIC_SUPABASE_URL="https://your-project.supabase.co"
  NEXT_PUBLIC_SUPABASE_ANON_KEY="your-anon-key"
  SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"  # Server-side only, never expose!

  # Optional: Supabase Local Development
  # NEXT_PUBLIC_SUPABASE_URL="http://localhost:54321"
  # NEXT_PUBLIC_SUPABASE_ANON_KEY="your-local-anon-key"

  # Optional: OAuth Providers (configure in Supabase Dashboard)
  # Already configured in Supabase, no keys needed in .env unless custom

  # Optional: Upstash Redis (if using caching)
  # UPSTASH_REDIS_REST_URL=""
  # UPSTASH_REDIS_REST_TOKEN=""

# TypeScript Configuration
tsconfig_strict:
  compilerOptions:
    strict: true
    noImplicitAny: true
    strictNullChecks: true
    strictFunctionTypes: true
    strictBindCallApply: true
    strictPropertyInitialization: true
    noImplicitThis: true
    alwaysStrict: true
    noUnusedLocals: true
    noUnusedParameters: true
    noImplicitReturns: true
    noFallthroughCasesInSwitch: true

# Notes for Future UI
ui_configuration_hints:
  - category: "Project Type"
    options: ["Full-stack SaaS", "Landing Page", "E-commerce", "Dashboard"]
    affects: ["auth", "database", "state"]

  - category: "Deployment Target"
    options: ["Vercel", "AWS", "Self-hosted", "Edge (Cloudflare)"]
    affects: ["database", "animation"]

  - category: "Design System"
    options: ["shadcn/ui", "Material UI", "Custom"]
    affects: ["ui", "styling"]

  - category: "Authentication"
    options: ["Self-hosted (NextAuth)", "Managed (Clerk)", "Supabase", "None"]
    required: true

  - category: "Database"
    options: ["PostgreSQL + Prisma", "SQLite + Drizzle", "Supabase", "None"]
    required: true

# Real-world Stack Examples
examples:
  vercel_dashboard:
    name: "Vercel Dashboard Stack"
    ui: "Custom + Tailwind"
    database: "PostgreSQL + Prisma"
    auth: "Custom"
    state: "SWR"

  linear:
    name: "Linear Stack"
    ui: "Custom + Tailwind"
    database: "PostgreSQL + Prisma"
    state: "GraphQL + Apollo"
    animation: "Framer Motion"

  supabase_dashboard:
    name: "Supabase Dashboard Stack"
    ui: "Tailwind + Custom"
    database: "Supabase (PostgreSQL)"
    auth: "Supabase Auth"
    state: "React Query"
